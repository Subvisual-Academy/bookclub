<div class="Books">
  <%= form_with(url: books_path, method: "get") do |f| %>
    <div class='form-group'>
      <%= f.select :user_id, @users.map {|u| ["#{u.name} - #{u.books.distinct.count}",u.id]}.insert(0, ["All Users - #{Book.all.count}", 0]), {:selected => params[:user_id] || "0" } , {onchange: 'this.form.submit();'} %>
    </div>
  <% end %>

  <%= link_to 'Create New Book', new_book_path, class: "books-NewButton" %>

  <table class="Table">
    <thead>
      <tr>
        <th>Image</th>
        <th>Title</th>
        <th>Author</th>
        <th colspan="3"></th>
      </tr>
    </thead>

    <tbody>
      <% @books.each do |book| %>
        <tr>
          <td>
            <div class="u-popup">
              <% if book.image%>
                <img src="<%= book.image %>"  alt="book cover"/>
              <% else %>
                <%= inline_svg_tag "question-mark.svg", alt: "unknown book cover", class: "Books-unknown" %>
              <% end %>

              <span class="u-popupContent popup-BookPopup">
                <%= book.synopsis || "Unavailable" %>
              </span>
            </div>
          </td>

          <td><%= book.title %></td>

          <td><%= book.author || "Unavailable" %></td>

            <td><%= link_to 'Show', book %></td>
          <% if current_user %>
            <td><%= link_to 'Edit', edit_book_path(book) %></td>
            <td><%= link_to 'Destroy', book, method: :delete, data: { confirm: 'Are you sure?' } %></td>
          <% end %>
        </tr>
      <% end %>
    </tbody>
  </table>
</div>
